/**
 * App.js minified
 * 08-06-2013
 */
function waitMsg(e,t,n){e=e||false;t=t||null;n=n||null;if(xhr_msg!==null)xhr_msg.abort();xhr_msg=$.ajax({url:"getData.php",type:"GET",dataType:"json",async:true,cache:false,data:{timestamp:timestamp,name:t,msg:n,action:"chat_content"},success:function(t){if(e){$("#announcement").html("<p><strong>Hi "+$("#name").val()+", welcome to chat</strong></p>")}if(t.msg!=""){$("#msgs").html(unescape(t.msg));if(e){setTimeout(function(){$("#content").animate({scrollTop:$("#content").prop("scrollHeight")-$("#content").height()},100)},2e3)}else{$("#content").animate({scrollTop:$("#content").prop("scrollHeight")-$("#content").height()},100)}fix_href();fix_msg()}timestamp=t.timestamp;setTimeout("waitMsg()",1e3)},error:function(e,t,n){if(t!=="abort")setTimeout("waitMsg()",1e4)}})}function fix_href(){$("#msgs").find("a:not([href^='http://'], [href^='https://'])").each(function(){$(this).attr("href","http://"+$(this).attr("href"))})}function fix_msg(){$("#msgs").find("span[data-user='"+$("#name").val()+"']").each(function(){$(this).attr("class","text-muted")})}function login(){var e=$(this),t=$("#nickname").val();if($.trim(t)==""){$(".modal-body").prepend('<div class="alert alert-error">'+"<strong>Oh crap!</strong>  You should have a name."+"</div>")}else{$.ajax({url:"getData.php",type:"POST",dataType:"json",async:true,cache:false,data:{nickname:t,action:"login"},beforeSend:function(){$(".alert-error").remove();e.button("loading")},success:function(n){if(!n.error){e.button("reset");$("#myModal").modal("hide");$("#nickname").val("");$("#name").addClass("hide").val(t);$("#current_user").text(t);$("#message").attr("id","content");$(".dropdown").removeClass("hide");$("ul.first-nav").append('<li class="active span2"><a id="current_user" href="#">'+t+"</a></li>");waitMsg(true,t);get_online()}else{e.button("reset");$(".modal-body").prepend('<div class="alert alert-error">'+"<strong>Oh crap!</strong> "+n.msg+"</div>")}}})}}function get_online(){if(xhr_ol!==null)xhr_ol.abort();xhr_ol=$.ajax({url:"getData.php",type:"GET",dataType:"json",async:true,cache:false,data:{timestamp:timestamp,action:"whosonline"},success:function(e){var t=[];var n=[];if($.isArray(e.online)){$.each(e.online,function(e,r){var i="";switch(r.status){case"online":i=" label-success";break;case"away":i=" label-warning";break;case"busy":i=" label-important";break;case"invisible":case"offline":i=" ";break;default:i=" label-success";break}t[e]="<p class='label"+i+" btn-block'>"+r.name+"</p>";n[e]=r.name})}$(".online-user").html(t.join(""));if($("#name").val()!==""){if($.inArray($("#name").val(),n)===-1){logout();return}}timestamp=e.timestamp;setTimeout("get_online()",1e3)},error:function(e,t,n){setTimeout("get_online()",15e3)}})}function logout(){$.ajax({url:"getData.php",type:"GET",dataType:"json",async:true,cache:false,data:{action:"logout"},success:function(e){window.location.reload()}})}function reset(e){$("#myModal").modal("hide");$("#nickname").val("");$("#name").addClass("hide").val(e);$("#current_user").text(e);$("#message").attr("id","content");waitMsg(true,e)}function change_status(e,t){$.ajax({url:"getData.php",type:"POST",dataType:"json",data:{status:e,action:"change_status"},success:function(n){if(!n.error){var r="";switch(e){case"online":r=" label-success";break;case"away":r=" label-warning";break;case"busy":r=" label-important";break;case"invisible":case"offline":r=" ";break;default:r=" label-success";break}$(".online-user p").each(function(){if($(this).text()===$("#name").val()){$(this).removeAttr("class").addClass("label"+r+" btn-block")}});$("#status").text(t)}}})}var timestamp=null,xhr_msg=null,xhr_ol=null